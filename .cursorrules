# Cursor AI Rules for Resell Rebel

## üîí MANDATORY CONTRACT COMPLIANCE

Before suggesting ANY code changes, you MUST read and verify compliance with:

1. **docs/GLOBAL_CONTRACT.md** (master ruleset)
2. **docs/SYSTEM-CONTRACT.md** (auth + UI)
3. **docs/DATA_MODEL.md** (database schema)

## Key Rules (Strictly Enforced)

### UI System (IMMUTABLE)
- **Red (#DC2626)**: Primary actions ONLY ‚Äî maximum ONE per page
- **Steel (#475569)**: Secondary actions
- **Charcoal (#1F2937)**: Utility actions (Save Draft, Cancel, etc.)
- **NO**: Flat grey buttons, solid white buttons, custom colors
- **YES**: Material depth (elevation, shadows, edge highlights)

Bottom Navigation:
- Logged-in: Home, Create, Account (3 items ONLY)
- Account menu contains: Listings, Inventory, Storage, Invoicing, Alerts

### Authentication (IMMUTABLE)
- Stack: Supabase ‚Üí Flask-Login ‚Üí Redis ‚Üí PostgreSQL
- Every `db.getconn()` MUST have matching `db.putconn()`
- Use context managers: `with self._get_connection() as conn:`
- NEVER store connections on `self.conn`

### Database (IMMUTABLE)
- PostgreSQL via Supabase (NO SQLite)
- Connection pool: maxconn=2
- Storage location REQUIRED for all active listings
- Users: UUID primary key, OAuth support

## Conflict Resolution

If user request violates contract:
1. ‚ùå DO NOT suggest violating change
2. ‚úÖ Explain conflict with contract section reference
3. ‚úÖ Propose compliant alternative
4. ‚úÖ Let user decide

Example:
```
This violates docs/GLOBAL_CONTRACT.md Section 2.2:
"Only ONE red button per page"

Alternative: Use steel (#475569) for the second button
to maintain visual hierarchy.
```

## Code Review Checklist

Before accepting any completion:
- [ ] No multiple red buttons on same page
- [ ] Database operations use context managers
- [ ] Button styles from contract (red/steel/charcoal)
- [ ] No custom colors outside palette
- [ ] Bottom nav has exactly 3 items
- [ ] Auth renders server-side (current_user)

**The contracts are NON-NEGOTIABLE.**
