ğŸ”’ IMAGE OWNERSHIP NON-NEGOTIABLES (LOCKED)
1ï¸âƒ£ IMAGES ARE OWNED BY:

User â†’ Listing â†’ Image

Never:

Image â†’ Listing

Image â†’ User

Image floating on its own

If an image isnâ€™t attached to a listing and a user, it might as well not exist.

2ï¸âƒ£ DATABASE PAIRING IS REQUIRED (NO EXCEPTIONS)

An image must be physically paired with its listing in the database.

That pairing is the truth.
The URL is just a pointer.

Conceptually:

User
 â””â”€â”€ Listing
      â”œâ”€â”€ title
      â”œâ”€â”€ description
      â”œâ”€â”€ price
      â””â”€â”€ images[]  â† REQUIRED ASSOCIATION
           â”œâ”€â”€ image_id
           â”œâ”€â”€ storage_path
           â”œâ”€â”€ url
           â”œâ”€â”€ order
           â”œâ”€â”€ uploaded_at


If that images[] relationship breaks, the system is broken.

3ï¸âƒ£ URL â‰  STORAGE â‰  OWNERSHIP

This distinction is critical.

Storage: disk, bucket, CDN

URL: how browsers fetch it

Ownership: database relationship

Ownership lives only in the database.

If the database says:

â€œThis listing has these imagesâ€

Then:

Refreshing the page must show them

Re-editing the listing must show them

Exporting the listing must include them

Deleting the listing must remove them (or orphan-clean them)

4ï¸âƒ£ IMAGE UPLOAD FLOW (NON-NEGOTIABLE)

This is the only acceptable flow.

Step 1: User uploads image

Image is uploaded to storage

Temporary storage path is returned

Step 2: Image is immediately attached to:

user_id

listing_id

This happens before save, not after.

Step 3: UI reflects database truth

Thumbnail renders from DB-backed image list

Not from local state alone

If the page refreshes and images disappear, the pairing failed.

5ï¸âƒ£ DRAFT LISTINGS STILL OWN IMAGES

Important edge case.

Even if:

Listing isnâ€™t published

User hasnâ€™t filled all fields

AI hasnâ€™t run

The listing must still have:

A real listing_id

Images attached to that ID

No â€œtemporary image cacheâ€ nonsense.

Draft â‰  fake.

6ï¸âƒ£ DELETION RULES (ALSO NON-NEGOTIABLE)

Delete image â†’ removes only that image

Delete listing â†’ removes all associated images

Delete user â†’ cascades listings â†’ cascades images

No loose debris in storage.

7ï¸âƒ£ EXPORT / CSV / SITE MAPPING IMPLICATION

When exporting to a site:

Images are resolved from listing â†’ images[]

Converted to URLs if required

Order preserved

Missing images = validation error

CSV never owns images.
Listings do.

8ï¸âƒ£ ACCEPTANCE TEST (THIS IS THE LAW)

Upload image
Save listing
Refresh page
Log out
Log back in
Open listing
Images are still there

If that fails, image support is not implemented, no matter what UI says.

ğŸ§± WHY THIS MATTERS (AND YOUâ€™RE RIGHT)

What youâ€™re preventing:

Ghost images

Cross-user leaks

â€œWhy did my images disappear?â€

CSV exports missing photos

AI overwriting image state

Storage bloat with no ownership

Youâ€™re forcing the system to behave like a ledger, not a scratchpad.

NEXT STEP (VERY SPECIFIC)

To move forward cleanly, the next thing we should do is one of these, not both:

Define the listing + image database schema

Walk through the image upload endpoint step-by-step and find where the pairing breaks

Tell me which one you want to lock next, and weâ€™ll hammer it into something unbreakable ğŸ”©

thats all the same thing. lets start from the begining lol

ğŸ˜‚ fair. Wipe the whiteboard. Fresh marker. We start at absolute zero and build only what must exist, in the order reality demands.

No abstractions yet. No â€œeventuallyâ€. Just what has to be true for the app to stop lying to you.

ğŸ§± START FROM THE BEGINNING: THE ONE TRUE FLOW
TRUTH #0 (THE ROOT)

Nothing exists unless a user exists.

So everything hangs off user_id. Period.

If we violate this once, bugs multiply forever.

1ï¸âƒ£ USER (FOUNDATION)
Non-Negotiables

A user has a unique user_id

Every action is scoped to that user

No anonymous writes to the database

Acceptance Test

User logs in â†’ user_id exists â†’ every page knows who they are

If this isnâ€™t rock solid, stop.

2ï¸âƒ£ LISTING (THE FIRST REAL OBJECT)

Before images. Before AI. Before CSV.
A listing must exist first.

Non-Negotiables

A listing is created immediately

Even if empty

Even if draft

Even if user just clicked â€œCreateâ€

A listing has:

listing_id

user_id

status (draft | published)

No â€œtemporary listing stateâ€

Drafts are real

Drafts are saved

Acceptance Test

Click â€œNew Listingâ€ â†’ listing_id created â†’ refresh â†’ listing still exists

If listings donâ€™t persist, nothing else matters.

3ï¸âƒ£ IMAGES (NOW THEY MAKE SENSE)

Images cannot exist without a listing to attach to.

This is why we had to start here.

Image Truth

Images belong to a listing. Listings belong to a user.

Non-Negotiables

Image upload requires:

user_id

listing_id

Upload flow:

Upload file

Store file

Create DB record paired to listing

UI renders images from the database, not memory

Acceptance Test

Upload image â†’ save â†’ refresh â†’ image still there
Log out â†’ log in â†’ image still there

If that fails, image support does not exist.

4ï¸âƒ£ BUTTONS (NOW WE CAN TRUST THEM)

Buttons donâ€™t act on ideas.
They act on real objects.

Non-Negotiables

Every button:

Knows the listing_id

Has a success or failure response

Disabled if prerequisites arenâ€™t met

Example

â€œUpload Imageâ€ disabled if no listing_id

â€œGenerate AIâ€ disabled if listing doesnâ€™t exist

Acceptance Test

Click button â†’ visible outcome every time

5ï¸âƒ£ AI (ONLY AFTER DATA EXISTS)

AI doesnâ€™t create listings.
AI fills fields on existing listings.

Non-Negotiables

AI requires:

listing_id

existing fields as input

AI writes results back to the listing

AI failure:

Does not erase data

Does not hang UI

Acceptance Test

Click AI â†’ text appears in fields OR error explains why

If AI canâ€™t write to the DB, it doesnâ€™t exist.

6ï¸âƒ£ CREDENTIALS (PARALLEL, NOT BLOCKING)

Credentials are account-level, not listing-level.

Non-Negotiables

Credentials page loads even with zero entries

Site picker always renders

No internal errors, ever

Acceptance Test

Navigate to credentials â†’ page loads â†’ no crash

7ï¸âƒ£ CSV (LAST, BECAUSE IT CONSUMES EVERYTHING)

CSV is not input first.
CSV is projection of listings.

Non-Negotiables

CSV imports create or update listings

CSV exports read from listings + images

CSV never owns data

Acceptance Test

Import CSV â†’ listings created â†’ images attach later â†’ export works