{% extends "base.html" %}

{% block title %}Cards Vault - Operational View{% endblock %}

{% block content %}

<!-- Vault Header - Compact -->
<div class="vault-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="vault-title"><i class="fas fa-id-card"></i> Cards Vault</h1>
            <div class="vault-subtitle">Operational Command Center</div>
        </div>
        <div class="vault-stats-compact">
            <span class="stat-chip" id="totalCards">0 cards</span>
            <span class="stat-chip" id="totalValue">$0</span>
            <span class="stat-chip" id="listedCards">0 listed</span>
        </div>
    </div>
</div>

<!-- Global Vault Controls -->
<div class="vault-controls-bar">
    <div class="row g-2 align-items-center">
        <!-- Search -->
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" id="globalSearch" placeholder="Search all cards...">
            </div>
        </div>

        <!-- Filter -->
        <div class="col-md-2">
            <select class="form-select" id="globalFilter">
                <option value="">All Status</option>
                <option value="stored">Stored</option>
                <option value="draft">Draft</option>
                <option value="listed">Listed</option>
                <option value="sold">Sold</option>
                <option value="archived">Archived</option>
            </select>
        </div>

        <!-- Bulk Actions -->
        <div class="col-md-3">
            <div class="btn-group" role="group">
                <button class="btn btn-outline-secondary btn-sm" id="bulkMove" disabled>
                    <i class="fas fa-arrows-alt"></i> Move
                </button>
                <button class="btn btn-outline-secondary btn-sm" id="bulkStatus" disabled>
                    <i class="fas fa-tag"></i> Status
                </button>
                <button class="btn btn-outline-danger btn-sm" id="bulkDelete" disabled>
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-md-3">
            <div class="btn-group" role="group">
                <button class="btn btn-primary btn-sm" onclick="showAddCardModal()">
                    <i class="fas fa-plus"></i> Add
                </button>
                <button class="btn btn-outline-primary btn-sm" onclick="showImportModal()">
                    <i class="fas fa-upload"></i> Import
                </button>
                <button class="btn btn-outline-primary btn-sm" onclick="exportCards()">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Status Legend -->
<div class="status-legend">
    <span class="status-chip status-stored">Stored</span>
    <span class="status-chip status-draft">Draft</span>
    <span class="status-chip status-listed">Listed</span>
    <span class="status-chip status-sold">Sold</span>
    <span class="status-chip status-archived">Archived</span>
</div>

<!-- Primary View Navigation -->
<div class="primary-view-nav">
    <div class="view-tabs">
        <button class="view-tab active" data-view="franchise">
            <i class="fas fa-building"></i>
            <span>By Franchise</span>
        </button>
        <button class="view-tab" data-view="set">
            <i class="fas fa-layer-group"></i>
            <span>By Set</span>
        </button>
        <button class="view-tab" data-view="status">
            <i class="fas fa-tag"></i>
            <span>By Status</span>
        </button>
        <button class="view-tab" data-view="storage">
            <i class="fas fa-map-marker-alt"></i>
            <span>By Storage</span>
        </button>
    </div>
    <div class="view-actions">
        <a href="{{ url_for('vault_overview') }}" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left"></i> Back to Vault
        </a>
    </div>
</div>

<!-- Franchise Filter Button (Shows when "By Franchise" view is active) -->
<div id="franchiseFilterContainer" class="franchise-filter-bar mt-3 mb-3">
    <div class="d-flex align-items-center gap-2 flex-wrap">
        <span class="text-muted"><strong>Filter by Franchise:</strong></span>
        <div class="btn-group" role="group">
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn active" data-franchise="all">
                <i class="fas fa-th"></i> All
            </button>
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn" data-franchise="pokemon">
                <i class="fas fa-fire"></i> Pokémon
            </button>
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn" data-franchise="mtg">
                <i class="fas fa-hat-wizard"></i> MTG
            </button>
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn" data-franchise="yugioh">
                <i class="fas fa-crown"></i> Yu-Gi-Oh!
            </button>
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn" data-franchise="sports">
                <i class="fas fa-football-ball"></i> Sports
            </button>
            <button class="btn btn-outline-primary btn-sm franchise-filter-btn" data-franchise="other">
                <i class="fas fa-ellipsis-h"></i> Other
            </button>
        </div>
    </div>
</div>

<!-- Cards Grid Container -->
<div id="cardsContainer" class="cards-grid-container">
    <!-- Cards will be loaded here -->
    <div class="loading-state">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Loading cards...</span>
    </div>
</div>

<!-- Add Card Modal -->
<div class="modal fade" id="addCardModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Cards to Vault</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle"></i> <strong>Tip:</strong> To scan cards with your camera, use the <a href="{{ url_for('create_listing') }}" class="alert-link">Create page</a>.
                </div>

                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#manualTab">
                            <i class="fas fa-keyboard"></i> Manual Entry
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#importTab">
                            <i class="fas fa-file-csv"></i> Import CSV
                        </button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- Manual Tab -->
                    <div class="tab-pane fade show active" id="manualTab">
                        <form id="manualCardForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Card Type *</label>
                                        <select class="form-select" id="manualCardType" required onchange="updateManualFields()">
                                            <option value="">Select type...</option>
                                            <option value="pokemon">Pokémon</option>
                                            <option value="mtg">Magic: The Gathering</option>
                                            <option value="yugioh">Yu-Gi-Oh!</option>
                                            <option value="sports_nfl">NFL</option>
                                            <option value="sports_nba">NBA</option>
                                            <option value="sports_mlb">MLB</option>
                                            <option value="sports_nhl">NHL</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label" id="nameLabel">Card/Player Name *</label>
                                        <input type="text" class="form-control" id="manualCardName" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Brand/Set</label>
                                        <input type="text" class="form-control" id="manualBrand">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Card Number</label>
                                        <input type="text" class="form-control" id="manualCardNumber">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Year</label>
                                        <input type="number" class="form-control" id="manualYear" min="1900" max="2099">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="manualQuantity" value="1" min="1">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Storage Location</label>
                                        <input type="text" class="form-control" id="manualStorage" placeholder="Box 1, Binder A, etc.">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-plus"></i> Add to Vault
                            </button>
                        </form>
                    </div>

                    <!-- Import Tab -->
                    <div class="tab-pane fade" id="importTab">
                        <div class="mb-3">
                            <label class="form-label">Upload CSV File</label>
                            <input type="file" class="form-control" id="csvImportInput" accept=".csv">
                        </div>
                        <button class="btn btn-primary" onclick="importCSV()">
                            <i class="fas fa-upload"></i> Import Cards
                        </button>
                        <hr>
                        <small class="text-muted">
                            CSV should have columns: Card Type, Card Name, Brand, Card Number, Year, Quantity, Storage Location
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Cards</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Select CSV File</label>
                    <input type="file" class="form-control" id="importFile" accept=".csv">
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="overwriteExisting">
                    <label class="form-check-label">
                        Overwrite existing cards
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="processImport()">Import</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
let currentView = 'franchise';
let currentFranchiseFilter = 'all';
let allCards = [];
let selectedCards = new Set();
let addCardModal, importModal;

document.addEventListener('DOMContentLoaded', function() {
    addCardModal = new bootstrap.Modal(document.getElementById('addCardModal'));
    importModal = new bootstrap.Modal(document.getElementById('importModal'));

    // Initialize view tabs
    document.querySelectorAll('.view-tab').forEach(tab => {
        tab.addEventListener('click', () => switchView(tab.dataset.view));
    });

    // Initialize franchise filter buttons
    document.querySelectorAll('.franchise-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => filterByFranchise(btn.dataset.franchise));
    });

    loadCards();
    loadStats();

    // Global search
    document.getElementById('globalSearch').addEventListener('input', filterCards);
    document.getElementById('globalFilter').addEventListener('change', filterCards);
});
async function loadCards() {
    try {
        showLoading();
        const response = await fetch('/api/cards/list?limit=1000');
        const data = await response.json();

        if (data.success) {
            allCards = data.cards;
            displayCardsByView(allCards);
        }
    } catch (error) {
        console.error('Failed to load cards:', error);
        showEmptyState();
    } finally {
        hideLoading();
    }
}

async function loadStats() {
    try {
        const response = await fetch('/api/cards/stats');
        const data = await response.json();

        if (data.success) {
            const stats = data.stats;
            document.getElementById('totalCards').textContent = `${stats.total_cards || 0} cards`;
            document.getElementById('totalValue').textContent = `$${stats.total_value || 0}`;
            document.getElementById('listedCards').textContent = `${stats.listed_count || 0} listed`;
        }
    } catch (error) {
        console.error('Failed to load stats:', error);
    }
}

function switchView(view) {
    currentView = view;

    // Update active tab
    document.querySelectorAll('.view-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-view="${view}"]`).classList.add('active');

    // Show/hide franchise filter based on current view
    const franchiseFilterContainer = document.getElementById('franchiseFilterContainer');
    if (view === 'franchise') {
        franchiseFilterContainer.style.display = 'block';
    } else {
        franchiseFilterContainer.style.display = 'none';
    }

    // Reset franchise filter when switching views
    currentFranchiseFilter = 'all';
    document.querySelectorAll('.franchise-filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector('[data-franchise="all"]').classList.add('active');

    displayCardsByView(allCards);
}

function displayCardsByView(cards) {
    const container = document.getElementById('cardsContainer');

    if (cards.length === 0) {
        showEmptyState();
        return;
    }

    switch (currentView) {
        case 'franchise':
            displayByFranchise(cards);
            break;
        case 'set':
            displayBySet(cards);
            break;
        case 'status':
            displayByStatus(cards);
            break;
        case 'storage':
            displayByStorage(cards);
            break;
    }
}

function filterByFranchise(franchise) {
    currentFranchiseFilter = franchise;

    // Update active button
    document.querySelectorAll('.franchise-filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-franchise="${franchise}"]`).classList.add('active');

    // Filter cards based on franchise
    let filteredCards = allCards;
    if (franchise !== 'all') {
        filteredCards = allCards.filter(card => {
            const cardFranchise = (card.franchise || card.game_name || card.sport || 'Other').toLowerCase();
            const franchiseKey = franchise.toLowerCase();
            
            // Handle sports franchise grouping
            if (franchise === 'sports') {
                return cardFranchise.includes('nfl') || cardFranchise.includes('nba') || 
                       cardFranchise.includes('mlb') || cardFranchise.includes('nhl');
            }
            
            return cardFranchise.includes(franchiseKey);
        });
    }

    // Re-display cards with the filter applied
    displayCardsByView(filteredCards);
}

function displayByFranchise(cards) {
    const container = document.getElementById('cardsContainer');
    const franchises = {};

    // Group by franchise
    cards.forEach(card => {
        const franchise = card.franchise || card.game_name || card.sport || 'Other';
        if (!franchises[franchise]) franchises[franchise] = [];
        franchises[franchise].push(card);
    });

    let html = '';
    Object.keys(franchises).sort().forEach(franchise => {
        const franchiseCards = franchises[franchise];
        html += `
            <div class="franchise-section">
                <div class="franchise-header">
                    <h5><i class="fas fa-building"></i> ${franchise}</h5>
                    <span class="badge bg-secondary">${franchiseCards.length} cards</span>
                </div>
                <div class="cards-grid">
                    ${franchiseCards.map(card => createCardElement(card)).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function displayBySet(cards) {
    const container = document.getElementById('cardsContainer');
    const sets = {};

    // Group by set
    cards.forEach(card => {
        const setName = card.set_name || 'No Set';
        if (!sets[setName]) sets[setName] = [];
        sets[setName].push(card);
    });

    let html = '';
    Object.keys(sets).sort().forEach(setName => {
        const setCards = sets[setName];
        html += `
            <div class="set-section">
                <div class="set-header">
                    <h5><i class="fas fa-layer-group"></i> ${setName}</h5>
                    <span class="badge bg-secondary">${setCards.length} cards</span>
                </div>
                <div class="cards-grid">
                    ${setCards.map(card => createCardElement(card)).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function displayByStatus(cards) {
    const container = document.getElementById('cardsContainer');
    const statuses = { stored: [], draft: [], listed: [], sold: [], archived: [] };

    // Group by status
    cards.forEach(card => {
        const status = card.status || 'stored';
        if (statuses[status]) {
            statuses[status].push(card);
        } else {
            statuses.stored.push(card);
        }
    });

    let html = '';
    Object.keys(statuses).forEach(status => {
        const statusCards = statuses[status];
        if (statusCards.length === 0) return;

        const statusClass = `status-${status}`;
        html += `
            <div class="status-section">
                <div class="status-header">
                    <h5><span class="status-chip ${statusClass}">${status}</span></h5>
                    <span class="badge bg-secondary">${statusCards.length} cards</span>
                </div>
                <div class="cards-grid">
                    ${statusCards.map(card => createCardElement(card)).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function displayByStorage(cards) {
    const container = document.getElementById('cardsContainer');
    const storage = {};

    // Group by storage location
    cards.forEach(card => {
        const location = card.storage_location || 'Unassigned';
        if (!storage[location]) storage[location] = [];
        storage[location].push(card);
    });

    let html = '';
    Object.keys(storage).sort().forEach(location => {
        const locationCards = storage[location];
        html += `
            <div class="storage-section">
                <div class="storage-header">
                    <h5><i class="fas fa-map-marker-alt"></i> ${location}</h5>
                    <span class="badge bg-secondary">${locationCards.length} cards</span>
                </div>
                <div class="cards-grid">
                    ${locationCards.map(card => createCardElement(card)).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function createCardElement(card) {
    const statusClass = `status-${card.status || 'stored'}`;
    const isSelected = selectedCards.has(card.id);

    return `
        <div class="card-element ${isSelected ? 'selected' : ''}" data-card-id="${card.id}">
            <div class="card-checkbox">
                <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleCardSelection(${card.id})">
            </div>
            <div class="card-image">
                ${card.photos && card.photos.length > 0 ?
                    `<img src="/${card.photos[0]}" alt="${card.title}">` :
                    `<i class="fas fa-id-card"></i>`
                }
            </div>
            <div class="card-info">
                <div class="card-title">${card.title}</div>
                <div class="card-meta">
                    ${card.set_name ? `<span class="meta-item">${card.set_name}</span>` : ''}
                    ${card.card_number ? `<span class="meta-item">#${card.card_number}</span>` : ''}
                    ${card.rarity ? `<span class="meta-item">${card.rarity}</span>` : ''}
                </div>
                <div class="card-status">
                    <span class="status-chip ${statusClass}">${card.status || 'stored'}</span>
                    ${card.quantity > 1 ? `<span class="quantity-badge">x${card.quantity}</span>` : ''}
                </div>
            </div>
            <div class="card-actions">
                <button class="action-btn" onclick="viewCard(${card.id})" title="View Details">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn" onclick="editCard(${card.id})" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn" onclick="moveCard(${card.id})" title="Move/Change Status">
                    <i class="fas fa-arrows-alt"></i>
                </button>
                <button class="action-btn" onclick="listCard(${card.id})" title="Create Listing" ${card.status === 'listed' ? 'disabled' : ''}>
                    <i class="fas fa-external-link-alt"></i>
                </button>
            </div>
        </div>
    `;
}

function showEmptyState() {
    const container = document.getElementById('cardsContainer');
    container.innerHTML = `
        <div class="empty-state">
            <i class="fas fa-id-card"></i>
            <h4>Your Cards Vault is Empty</h4>
            <p>No cards in your private collection yet.</p>
            <div class="empty-actions">
                <button class="btn btn-primary" onclick="showAddCardModal()">
                    <i class="fas fa-plus"></i> Add Cards
                </button>
                <a href="{{ url_for('create_listing') }}" class="btn btn-outline-primary">
                    <i class="fas fa-camera"></i> Scan Cards
                </a>
            </div>
        </div>
    `;
}

function showLoading() {
    const container = document.getElementById('cardsContainer');
    container.innerHTML = `
        <div class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Loading cards...</span>
        </div>
    `;
}

function hideLoading() {
    // Loading is hidden when content is replaced
}

function filterCards() {
    const searchQuery = document.getElementById('globalSearch').value.toLowerCase();
    const statusFilter = document.getElementById('globalFilter').value;

    let filteredCards = allCards;

    // Apply search filter
    if (searchQuery) {
        filteredCards = filteredCards.filter(card =>
            card.title.toLowerCase().includes(searchQuery) ||
            (card.set_name && card.set_name.toLowerCase().includes(searchQuery)) ||
            (card.player_name && card.player_name.toLowerCase().includes(searchQuery)) ||
            (card.franchise && card.franchise.toLowerCase().includes(searchQuery))
        );
    }

    // Apply status filter
    if (statusFilter) {
        filteredCards = filteredCards.filter(card => (card.status || 'stored') === statusFilter);
    }

    displayCardsByView(filteredCards);

    // Update bulk actions
    updateBulkActions();
}

function toggleCardSelection(cardId) {
    if (selectedCards.has(cardId)) {
        selectedCards.delete(cardId);
    } else {
        selectedCards.add(cardId);
    }
    updateBulkActions();
}

function updateBulkActions() {
    const bulkButtons = document.querySelectorAll('#bulkMove, #bulkStatus, #bulkDelete');
    const hasSelection = selectedCards.size > 0;

    bulkButtons.forEach(btn => {
        btn.disabled = !hasSelection;
    });

    // Update visual selection
    document.querySelectorAll('.card-element').forEach(card => {
        const cardId = parseInt(card.dataset.cardId);
        card.classList.toggle('selected', selectedCards.has(cardId));
    });
}

function showAddCardModal() {
    addCardModal.show();
}

function showImportModal() {
    importModal.show();
}

function viewCard(cardId) {
    window.location.href = `/vault/cards/${cardId}`;
}

function editCard(cardId) {
    window.location.href = `/vault/cards/${cardId}/edit`;
}

function moveCard(cardId) {
    // Implement move/change status functionality
    showAlert('Move functionality coming soon!', 'info');
}

function listCard(cardId) {
    window.location.href = `/create?card_id=${cardId}`;
}

function exportCards() {
    window.location.href = '/api/cards/export';
}

function processImport() {
    const fileInput = document.getElementById('importFile');
    const file = fileInput.files[0];
    const overwrite = document.getElementById('overwriteExisting').checked;

    if (!file) {
        showAlert('Please select a file', 'warning');
        return;
    }

    showLoading();

    fetch('/api/cards/import', {
        method: 'POST',
        body: new FormData().append('file', file)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert(`Imported ${data.imported} cards successfully!`, 'success');
            importModal.hide();
            loadCards();
            loadStats();
        } else {
            showAlert('Import failed', 'danger');
        }
    })
    .catch(error => {
        showAlert('Import error: ' + error, 'danger');
    })
    .finally(() => {
        hideLoading();
    });
}

function updateManualFields() {
    const cardType = document.getElementById('manualCardType').value;
    const nameLabel = document.getElementById('nameLabel');

    if (cardType.startsWith('sports_')) {
        nameLabel.textContent = 'Player Name *';
    } else {
        nameLabel.textContent = 'Card Name *';
    }
}

// Form submission
document.getElementById('manualCardForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
        manual_entry: {
            card_type: document.getElementById('manualCardType').value,
            title: document.getElementById('manualCardName').value,
            brand: document.getElementById('manualBrand').value,
            card_number: document.getElementById('manualCardNumber').value,
            year: document.getElementById('manualYear').value ? parseInt(document.getElementById('manualYear').value) : null,
            quantity: parseInt(document.getElementById('manualQuantity').value),
            storage_location: document.getElementById('manualStorage').value
        }
    };

    showLoading();

    try {
        const response = await fetch('/api/cards/add', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            showAlert('Card added to vault successfully!', 'success');
            addCardModal.hide();
            document.getElementById('manualCardForm').reset();
            loadCards();
            loadStats();
        } else {
            showAlert(data.error || 'Failed to add card', 'danger');
        }
    } catch (error) {
        showAlert('Failed to add card: ' + error, 'danger');
    } finally {
        hideLoading();
    }
});
</script>

<style>
/* Primary View Navigation */
.primary-view-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-primary);
}

.view-tabs {
    display: flex;
    gap: 4px;
}

.view-tab {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    font-weight: 600;
}

.view-tab:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.view-tab.active {
    background: var(--alert-crimson);
    border-color: var(--alert-crimson);
    color: white;
}

.view-actions .btn {
    font-size: 0.75rem;
}

/* Cards Grid Container */
.cards-grid-container {
    min-height: 400px;
}

/* Card Element */
.card-element {
    background: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
}

.card-element:hover {
    border-color: var(--alert-crimson);
    box-shadow: 0 2px 8px var(--shadow-primary);
}

.card-element.selected {
    border-color: var(--alert-crimson);
    background: var(--bg-secondary);
}

.card-checkbox {
    flex-shrink: 0;
}

.card-image {
    width: 60px;
    height: 60px;
    border-radius: 4px;
    background: var(--bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
}

.card-info {
    flex: 1;
    min-width: 0;
}

.card-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.card-meta {
    display: flex;
    gap: 8px;
    margin-bottom: 4px;
    flex-wrap: wrap;
}

.meta-item {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    padding: 1px 4px;
    border-radius: 8px;
    font-size: 0.625rem;
    font-weight: 600;
}

.card-status {
    display: flex;
    align-items: center;
    gap: 8px;
}

.quantity-badge {
    background: var(--cold-steel);
    color: white;
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 0.625rem;
    font-weight: 600;
}

.card-actions {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
}

.action-btn {
    background: none;
    border: 1px solid var(--border-primary);
    color: var(--text-secondary);
    padding: 4px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-btn:hover {
    background: var(--alert-crimson);
    border-color: var(--alert-crimson);
    color: white;
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Section Headers */
.franchise-header, .set-header, .status-header, .storage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding: 8px 12px;
    background: var(--bg-secondary);
    border-radius: 4px;
}

.franchise-header h5, .set-header h5, .status-header h5, .storage-header h5 {
    margin: 0;
    font-size: 1rem;
    color: var(--text-primary);
}

.franchise-header i, .set-header i, .status-header i, .storage-header i {
    margin-right: 8px;
    color: var(--alert-crimson);
}

/* Cards Grid */
.cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 8px;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 16px;
    display: block;
}

.empty-state h4 {
    margin-bottom: 8px;
}

.empty-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 20px;
}

/* Loading State */
.loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.loading-state i {
    font-size: 2rem;
    margin-bottom: 12px;
}

/* Responsive */
@media (max-width: 768px) {
    .primary-view-nav {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
    }

    .view-tabs {
        justify-content: center;
    }

    .card-element {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    .card-actions {
        align-self: stretch;
        justify-content: center;
    }

    .cards-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}